PHP进阶之数据库设计
=======

##第五节 常见的表结构  

**引言**

当给我们一个需求的时候，我们肯定会存在多种设计。那么设计方案肯定存在有多种。比如有一张表：

>> create table book (  
> book_id int,  
> class_id int,  
> book_name varchar(150),  
> ....

那么，如果有一个新的需要：查询某个分类下的所有图书，那么该怎么查询？

>> select ... from book where class_id = %d;

上面的查询可以满足需求（当然需要一定的索引），那么如果这类需求越来越多的时候，是要给每个查询都要加索引？

>> select ... from book where class_id = %d (or|and)
> book_style_1 = %d .....

另外，这个表应该怎么理解，它表示一个所有book的属性，还是，属性+查询的混合体？

**以题目为开始（同样也是个面试题）**

做一个关于图书的项目，其中有：  

1. 书（book）
2. 分类（class）

每本书又有借阅次数（num\_of\_borrow）、点击次数（num\_of\_click），并希望根据这个做排序；

要求如下：

1. 根据书的id查到某本书
2. 根据分类的id，查到该分类的信息（点击次数、分类下的图书量）
3. 根据分类的id，查该分类下的图书，并可以按点击次数、借阅次数排序

上面的问题如何设计？

**同学的方法**

**1. 两张表**



**2. 三张表**

**做法一：两张表**

1. 一张book表
2. 一张class表
3. 对book表中的class_id加索引。

>> select ... from book where class_id = ... order by ...;

优点：

1. 简单，方便，查询快，好理解
2. 手动操作方便

缺点：

1. 扩展性差
2. 效率随着数据量的增长而降低

**做法二：三张表**

1. 一张book表
2. 一张class表
3. 一张class和book的关系表（查询表），rel_class_book表

>> select ... from rel\_class\_book where class\_id = %d order by ... 
> select .. from book where book_id in ()

优点：

1. 扩展性好
2. 协同开发效率更高

缺点：

1. 查询性能有损伤
2. 初期开发麻烦

**数据表模型**

一般情况下，我们分数据表模型为两种类型：模型表和关系表。

1. model（模型）表，记录对象基本的属性，比如：book的名称，分类，销售量，点击量等
2. rel（关系）表，记录对象之间的关系（1-1,1-n,n-m），比如：book和class的关系。有的时候，关系表还承载了查询特性。
3. 我们实际工作中，所有的需求都可以用这两张表满足。

**问答**

1. 两个表和三个表哪种效率高呢  
	答：自己玩的话，两个表可能更合适；大家一起玩的话，三个表比较好；
2. 冗余度和查询方便、变更方便（性能）如何达到平衡？  
	答：当哪个成为瓶颈的时候，优先优化哪个环节。
3. model表是描述一个元素的，关系表是说不同元素之间的关系，这是不是要涉及到多表联查啊  
	答：不建议多表联查。为什么呢？如果我们做分表的话，怎么办？如果要扩展需求，但又不能直接改表的话，怎么办？
4. 后面我们讲分表  
5. 效率的话应该按数据的增长而降低，是酱紫的吧  
	答：理论上讲，数据量的增长性能都会降低（绝对的降低）。但可以尽量避免。